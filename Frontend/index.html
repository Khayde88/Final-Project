<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Grocery App</title>
</head>
<body>
    <h1>Welcome to My Grocery App</h1>
    
    <!-- Form to submit data to MongoDB -->
    <form id="mongodb-form">
        <label for="user-input">Enter your data:</label><br>
        <input type="text" id="user-input" name="user-input"><br>
        <button type="submit">Submit</button>
    </form>

    <!-- Display section for saved list -->
    <div>
        <h2>Saved List</h2>
        <ul id="saved-list"></ul>
    </div>

    <script>
        document.getElementById("mongodb-form").addEventListener("submit", function(event) {
            event.preventDefault(); // Prevent the default form submission
            
            // Get user input from the textbox
            const userInput = document.getElementById("user-input").value;

            // Send user input to the FastAPI endpoint
            fetch('/run-script', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams({
                    'input_data': userInput
                })
            })
            .then(response => response.json())
            .then(data => console.log(data))
            .then(() => alert('Data sent to MongoDB!'))
            //Clear the textbox after submission
            .then(() => document.getElementById("user-input").value = "")
            .catch(error => console.error('Error:', error));
        });

        // Function to delete an item from the saved list
        function deleteItem(itemId) {
            fetch(`/delete-saved-item/${itemId}`, {
                method: 'DELETE'
            })
            .then(response => {
                if (response.ok) {
                    location.reload(); // Reload the page to reflect the updated list
                } else {
                    console.error('Error deleting item');
                }
            })
            .catch(error => console.error('Error:', error));
        }

        // Fetch and display the saved list from MongoDB
        fetch('/read-saved-list')
        .then(response => response.json())
        .then(data => {
            const savedListElement = document.getElementById('saved-list');
            data.forEach(item => {
                const listItem = document.createElement('li');
                listItem.textContent = `date: ${item.date}, stores: ${item.stores.join(', ')}, location: ${item.location}`;
                
                // Add a delete button/icon
                const deleteButton = document.createElement('button');
                deleteButton.textContent = '❌';
                deleteButton.onclick = () => deleteItem(item._id);
                
                listItem.appendChild(deleteButton);
                savedListElement.appendChild(listItem);
            });
        })
        .catch(error => console.error('Error:', error));
    </script>
</body>
</html>

